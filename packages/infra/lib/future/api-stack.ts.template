/**
 * PHASE 2 TEMPLATE: API Stack
 *
 * This file outlines the planned API infrastructure for private
 * campaign notes and AI summarization. Do NOT implement until Phase 2.
 *
 * Architecture:
 * - API Gateway (HTTP API) for RESTful endpoints
 * - Lambda functions for business logic
 * - DynamoDB single-table design for notes storage
 * - KMS for note encryption at rest
 * - Claude API integration for summarization
 */

import * as cdk from 'aws-cdk-lib';
import * as dynamodb from 'aws-cdk-lib/aws-dynamodb';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as apigateway from 'aws-cdk-lib/aws-apigatewayv2';
import * as kms from 'aws-cdk-lib/aws-kms';
import { Construct } from 'constructs';

// TODO: Uncomment and implement in Phase 2

/*
export interface ApiStackProps extends cdk.StackProps {
  // Cognito User Pool ARN for JWT validation
  userPoolArn: string;
  // Claude API key (stored in Secrets Manager)
  claudeApiKeySecretArn: string;
  // S3 bucket for generated blog posts
  contentBucketArn: string;
}

export class ApiStack extends cdk.Stack {
  public readonly api: apigateway.HttpApi;
  public readonly notesTable: dynamodb.Table;

  constructor(scope: Construct, id: string, props: ApiStackProps) {
    super(scope, id, props);

    // TODO: Create KMS key for note encryption
    // - Alias: alias/campaign-notes
    // - Enable key rotation
    // - Restrict access to API Lambdas only

    // TODO: Create DynamoDB table for notes
    // Single-table design:
    //
    // Primary Key:
    //   PK: campaignId (partition key)
    //   SK: noteType#timestamp#noteId (sort key)
    //
    // GSI1 - UserNotesIndex:
    //   PK: userId
    //   SK: timestamp#noteId
    //
    // GSI2 - NoteTypeIndex:
    //   PK: campaignId#noteType
    //   SK: timestamp
    //
    // Entity Types (stored as noteType in SK):
    //   - SESSION: Game session notes
    //   - CHARACTER: Character information
    //   - LOCATION: World locations
    //   - NPC: Non-player characters
    //   - ITEM: Magic items, loot
    //   - QUEST: Quests and objectives
    //   - SUMMARY: AI-generated summaries
    //
    // Common Attributes:
    //   - id: UUID
    //   - title: string
    //   - content: string (encrypted)
    //   - authorId: string
    //   - createdAt: ISO timestamp
    //   - updatedAt: ISO timestamp
    //   - visibility: 'private' | 'campaign' | 'public'
    //   - tags: string[]
    //
    // Access Patterns:
    //   1. Get all notes for a campaign (by type): PK = campaignId, SK begins_with noteType#
    //   2. Get a user's personal notes: GSI1 PK = userId
    //   3. Get recent notes by type: GSI2 for time-ordered queries
    //   4. Get single note: PK = campaignId, SK = exact match

    // TODO: Create API Gateway HTTP API
    // - Cognito JWT authorizer
    // - CORS configuration for blog domain
    // - Custom domain (api.blog.example.com)
    // - Rate limiting: 100 requests/second

    // TODO: Create Lambda functions
    //
    // Notes CRUD:
    //   POST   /campaigns/{id}/notes - Create note
    //   GET    /campaigns/{id}/notes - List notes (with filters)
    //   GET    /campaigns/{id}/notes/{noteId} - Get note
    //   PUT    /campaigns/{id}/notes/{noteId} - Update note
    //   DELETE /campaigns/{id}/notes/{noteId} - Delete note
    //
    // Campaign management:
    //   POST   /campaigns - Create campaign
    //   GET    /campaigns - List user's campaigns
    //   GET    /campaigns/{id} - Get campaign details
    //   PUT    /campaigns/{id} - Update campaign
    //   DELETE /campaigns/{id} - Delete campaign
    //
    // Summarization:
    //   POST   /campaigns/{id}/summarize - Trigger AI summary
    //   GET    /campaigns/{id}/summaries - List summaries
    //
    // Export:
    //   POST   /campaigns/{id}/export - Export to blog post

    // TODO: Create summarization pipeline
    // Trigger: DynamoDB Streams on new notes
    // 1. Collect recent notes (last N or since last summary)
    // 2. Call Claude API with summarization prompt
    // 3. Store summary as SUMMARY note type
    // 4. Optionally trigger blog post generation

    // Outputs:
    // - API endpoint URL
    // - API custom domain
    // - Table name
  }
}
*/

/**
 * DynamoDB Single-Table Schema Reference:
 *
 * Example Items:
 *
 * Session Note:
 * {
 *   PK: "campaign#abc123",
 *   SK: "SESSION#2024-01-15T20:00:00Z#note-uuid",
 *   id: "note-uuid",
 *   type: "SESSION",
 *   title: "Session 5: The Dark Temple",
 *   content: "[encrypted]",
 *   authorId: "user-uuid",
 *   campaignId: "abc123",
 *   sessionNumber: 5,
 *   createdAt: "2024-01-15T22:30:00Z",
 *   tags: ["combat", "boss-fight", "loot"]
 * }
 *
 * AI Summary:
 * {
 *   PK: "campaign#abc123",
 *   SK: "SUMMARY#2024-01-16T10:00:00Z#summary-uuid",
 *   id: "summary-uuid",
 *   type: "SUMMARY",
 *   title: "Campaign Arc 1 Summary",
 *   content: "[AI-generated summary text]",
 *   authorId: "system",
 *   campaignId: "abc123",
 *   coversSessions: [1, 2, 3, 4, 5],
 *   generatedBy: "claude-3-sonnet",
 *   createdAt: "2024-01-16T10:00:00Z"
 * }
 *
 * Access Examples:
 *
 * // Get all session notes for campaign
 * Query: PK = "campaign#abc123", SK begins_with "SESSION#"
 *
 * // Get all of user's notes across campaigns
 * Query GSI1: PK = "user-uuid"
 *
 * // Get recent notes of any type for campaign
 * Query: PK = "campaign#abc123", ScanIndexForward = false, Limit = 20
 */

/**
 * Claude API Integration Notes:
 *
 * Summarization Prompt Template:
 * ```
 * You are a skilled D&D campaign chronicler. Summarize these session notes
 * into a narrative blog post suitable for the campaign's private blog.
 *
 * Requirements:
 * - Write in third person, past tense
 * - Highlight key plot developments
 * - Note character growth and decisions
 * - Preserve important NPC names and locations
 * - Include a "What Happened" section and "Looking Forward" teaser
 * - Keep spoiler-free for players who missed the session
 * - Aim for 500-1000 words
 *
 * Session Notes:
 * {notes}
 *
 * Previous Summary Context:
 * {previous_summary}
 * ```
 *
 * API Configuration:
 * - Model: claude-3-sonnet (balance of quality and cost)
 * - Max tokens: 2000
 * - Temperature: 0.7 (some creativity, but consistent)
 */

export { };
