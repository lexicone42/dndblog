---
/**
 * Personal dashboard after login
 * Shows role-appropriate navigation based on Cognito auth
 */

import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all characters for mapping slugs to names
const allCharacters = await getCollection('characters');
const characterMap = Object.fromEntries(
  allCharacters.map((c: typeof allCharacters[0]) => [c.id, c.data])
);

// Next mission story teaser - update this before each session!
const nextMissionTeaser = {
  title: "The Circle Closes",
  summary: "The Slanted Circle has the regulator plans, and the Ley Maw grows with each passing hour. Somewhere in Sharn's shadows, agents prepare a ritual that could tear the city apart—or open a door to something far worse.",
  date: "Session 11 • Soon",
};
---

<BaseLayout
  title="The Tavern - Rudiger's Evocation of Events"
  description="Your cozy corner of the campaign."
>
  <div class="dashboard">
    <!-- Loading state while checking auth -->
    <div id="loading-state" class="dashboard-state">
      <div class="loading-spinner"></div>
      <p class="loading-text">Consulting the oracles...</p>
    </div>

    <!-- Not authenticated state -->
    <div id="unauthenticated-state" class="dashboard-state" style="display: none;">
      <div class="auth-prompt">
        <div class="auth-prompt__frame">
          <div class="auth-prompt__corner auth-prompt__corner--tl"></div>
          <div class="auth-prompt__corner auth-prompt__corner--tr"></div>
          <div class="auth-prompt__corner auth-prompt__corner--bl"></div>
          <div class="auth-prompt__corner auth-prompt__corner--br"></div>
          <h1>Welcome, Traveler</h1>
          <p class="auth-prompt__subtitle">The chronicler awaits your credentials</p>
          <div class="auth-prompt__divider"></div>
          <p>Sign in to access your campaign dashboard and view the latest dispatches from the front.</p>
          <button id="sign-in-btn" class="btn btn-primary btn-large">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            Enter the Chronicle
          </button>
        </div>
      </div>
    </div>

    <!-- Authenticated state -->
    <div id="authenticated-state" class="dashboard-state" style="display: none;">
      <header class="dashboard-header">
        <div class="header-flourish">
          <span class="flourish-line"></span>
          <span class="flourish-diamond"></span>
          <span class="flourish-line"></span>
        </div>
        <p class="welcome-label">Welcome back</p>
        <h1 class="dashboard-title"><span id="user-name">Adventurer</span></h1>
        <div class="header-flourish header-flourish--bottom">
          <span class="flourish-line"></span>
          <span class="flourish-diamond"></span>
          <span class="flourish-line"></span>
        </div>
      </header>

      <!-- Next Mission Teaser - styled as a proclamation -->
      <article class="mission-teaser">
        <div class="mission-teaser__seal"></div>
        <header class="mission-teaser__header">
          <span class="mission-teaser__label">{nextMissionTeaser.date}</span>
        </header>
        <h2 class="mission-teaser__title">{nextMissionTeaser.title}</h2>
        <div class="mission-teaser__divider"></div>
        <p class="mission-teaser__summary">{nextMissionTeaser.summary}</p>
      </article>

      <div class="dashboard-grid">
        <!-- Player Section (shown if has character) -->
        <section id="player-section" class="dashboard-section" style="display: none;">
          <h2 class="section-title">
            <span class="section-title__text">Your Character</span>
          </h2>

          <a id="session-tracker-link" href="#" class="action-card action-card--primary">
            <div class="action-card__icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
              </svg>
            </div>
            <div class="action-content">
              <h3 class="action-title">Session Tracker</h3>
              <p class="action-description">Track HP, spell slots, and conditions during play.</p>
              <span id="character-name-badge" class="character-badge"></span>
            </div>
            <div class="action-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </div>
          </a>
        </section>

        <!-- DM Section (shown if DM) -->
        <section id="dm-section" class="dashboard-section dashboard-section--dm" style="display: none;">
          <h2 class="section-title section-title--dm">
            <span class="section-title__text">Dungeon Master</span>
          </h2>

          <div class="action-grid">
            <a href="/dm" class="action-card action-card--dm">
              <div class="action-card__icon action-card__icon--dm">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <line x1="10" y1="9" x2="8" y2="9"></line>
                </svg>
              </div>
              <div class="action-content">
                <h3 class="action-title">Session Notes</h3>
                <p class="action-description">Write, review, and publish session content.</p>
              </div>
            </a>

            <a href="/dm/party-tracker" class="action-card action-card--dm">
              <div class="action-card__icon action-card__icon--dm">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
              </div>
              <div class="action-content">
                <h3 class="action-title">Party Tracker</h3>
                <p class="action-description">View live party status during sessions.</p>
                <span class="live-badge">Live</span>
              </div>
            </a>

            <a href="/dm/entities" class="action-card action-card--dm">
              <div class="action-card__icon action-card__icon--dm">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                  <polyline points="2 17 12 22 22 17"></polyline>
                  <polyline points="2 12 12 17 22 12"></polyline>
                </svg>
              </div>
              <div class="action-content">
                <h3 class="action-title">Entity Editor</h3>
                <p class="action-description">Create and edit NPCs, items, and locations.</p>
              </div>
            </a>
          </div>
        </section>

        <!-- Always visible: Campaign resources -->
        <section class="dashboard-section">
          <h2 class="section-title">
            <span class="section-title__text">Campaign Resources</span>
          </h2>

          <div class="action-grid">
            <a href="/party" class="action-card">
              <div class="action-card__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
              </div>
              <div class="action-content">
                <h3 class="action-title">The Party</h3>
                <p class="action-description">View party members and their abilities.</p>
              </div>
            </a>

            <a href="/reference" class="action-card">
              <div class="action-card__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
              </div>
              <div class="action-content">
                <h3 class="action-title">World Compendium</h3>
                <p class="action-description">Locations, factions, and lore from the campaign.</p>
              </div>
            </a>
          </div>
        </section>
      </div>

      <!-- Account section -->
      <footer class="account-section">
        <div class="account-divider">
          <span class="divider-line"></span>
          <span class="divider-ornament"></span>
          <span class="divider-line"></span>
        </div>
        <button id="sign-out-btn" class="btn btn-secondary">Depart the Chronicle</button>
      </footer>
    </div>
  </div>
</BaseLayout>

<script>
  import { getLoginUrl } from '@lib/auth';

  // Sign-in button handler
  document.getElementById('sign-in-btn')?.addEventListener('click', () => {
    const loginUrl = getLoginUrl('/me');
    if (loginUrl && loginUrl !== '#') {
      window.location.href = loginUrl;
    } else {
      alert('The chronicle is sealed. Ask your DM for assistance.');
    }
  });
</script>

<script define:vars={{ characterMap }}>
  const COGNITO_AUTH_KEY = 'dndblog-cognito-auth';

  // Character name lookup
  const characters = characterMap;

  function getCharacterName(slug) {
    return characters[slug]?.name || slug;
  }

  function checkAuth() {
    const loadingState = document.getElementById('loading-state');
    const unauthState = document.getElementById('unauthenticated-state');
    const authState = document.getElementById('authenticated-state');

    const cognitoAuth = localStorage.getItem(COGNITO_AUTH_KEY);

    if (!cognitoAuth) {
      loadingState.style.display = 'none';
      unauthState.style.display = 'flex';
      return;
    }

    try {
      const auth = JSON.parse(cognitoAuth);

      // Check if expired
      if (auth.expiresAt && auth.expiresAt < Date.now()) {
        localStorage.removeItem(COGNITO_AUTH_KEY);
        loadingState.style.display = 'none';
        unauthState.style.display = 'flex';
        return;
      }

      // User is authenticated
      loadingState.style.display = 'none';
      authState.style.display = 'block';

      // Set user name
      const userName = auth.email?.split('@')[0] || 'Adventurer';
      document.getElementById('user-name').textContent = userName;

      // Show DM section if DM
      if (auth.roles?.isDm) {
        document.getElementById('dm-section').style.display = 'block';
      }

      // Show player section if has character
      const characterSlug = auth.characterSlug;
      if (characterSlug) {
        document.getElementById('player-section').style.display = 'block';
        document.getElementById('session-tracker-link').href = `/campaign`;
        document.getElementById('character-name-badge').textContent = getCharacterName(characterSlug);
      }

    } catch (e) {
      console.error('Auth parse error:', e);
      loadingState.style.display = 'none';
      unauthState.style.display = 'flex';
    }
  }

  // Sign out handler
  document.getElementById('sign-out-btn')?.addEventListener('click', () => {
    localStorage.removeItem(COGNITO_AUTH_KEY);
    window.dispatchEvent(new Event('auth-change'));
    window.location.href = '/';
  });

  // Check auth on load
  checkAuth();

  // Listen for auth changes
  window.addEventListener('storage', checkAuth);
  window.addEventListener('auth-change', checkAuth);
</script>

<style>
  /* Page container with subtle vignette */
  .dashboard {
    min-height: calc(100vh - var(--header-height) - 100px);
    padding: var(--space-2xl) var(--space-lg);
    max-width: 900px;
    margin: 0 auto;
    position: relative;
  }

  .dashboard::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at center, transparent 0%, var(--color-bg) 100%);
    opacity: 0.4;
    pointer-events: none;
    z-index: -1;
  }

  .dashboard-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #loading-state {
    min-height: 400px;
    color: var(--color-text-muted);
  }

  .loading-spinner {
    width: 48px;
    height: 48px;
    border: 2px solid var(--color-border);
    border-top-color: var(--color-gold);
    border-radius: 50%;
    animation: spin 1.2s ease-in-out infinite;
    margin-bottom: var(--space-lg);
    will-change: transform;
  }

  @media (prefers-reduced-motion: reduce) {
    .loading-spinner {
      animation: none;
      border-top-color: var(--color-gold);
      border-right-color: var(--color-gold);
    }
  }

  .loading-text {
    font-family: var(--font-serif);
    font-style: italic;
    color: var(--color-text-muted);
    letter-spacing: 0.02em;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Auth prompt - framed like a tavern sign */
  .auth-prompt {
    text-align: center;
    padding: var(--space-2xl);
    max-width: 480px;
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .auth-prompt__frame {
    position: relative;
    padding: var(--space-2xl) var(--space-xl);
    background: linear-gradient(
      135deg,
      var(--color-bg-secondary) 0%,
      var(--color-bg-tertiary) 50%,
      var(--color-bg-secondary) 100%
    );
    border: 2px solid var(--color-border);
    border-radius: var(--radius-md);
    box-shadow:
      0 4px 24px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  /* Decorative corners */
  .auth-prompt__corner {
    position: absolute;
    width: 24px;
    height: 24px;
    border-color: var(--color-gold);
    border-style: solid;
    border-width: 0;
    opacity: 0.6;
  }

  .auth-prompt__corner--tl {
    top: 8px;
    left: 8px;
    border-top-width: 2px;
    border-left-width: 2px;
  }

  .auth-prompt__corner--tr {
    top: 8px;
    right: 8px;
    border-top-width: 2px;
    border-right-width: 2px;
  }

  .auth-prompt__corner--bl {
    bottom: 8px;
    left: 8px;
    border-bottom-width: 2px;
    border-left-width: 2px;
  }

  .auth-prompt__corner--br {
    bottom: 8px;
    right: 8px;
    border-bottom-width: 2px;
    border-right-width: 2px;
  }

  .auth-prompt h1 {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    color: var(--color-gold);
    margin: 0;
    letter-spacing: 0.02em;
  }

  .auth-prompt__subtitle {
    font-family: var(--font-serif);
    font-style: italic;
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin: var(--space-xs) 0 var(--space-md);
    letter-spacing: 0.03em;
  }

  .auth-prompt__divider {
    width: 60px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-gold), transparent);
    margin: 0 auto var(--space-md);
  }

  .auth-prompt p:not(.auth-prompt__subtitle) {
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-lg);
    font-size: var(--text-base);
    line-height: 1.7;
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-lg);
    border-radius: var(--radius-sm);
    font-weight: 600;
    font-family: var(--font-sans);
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-size: var(--text-sm);
    letter-spacing: 0.02em;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--color-gold) 0%, var(--color-gold-light) 100%);
    color: var(--color-bg);
    box-shadow: 0 2px 8px rgba(var(--color-gold-rgb, 201, 162, 39), 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(var(--color-gold-rgb, 201, 162, 39), 0.4);
  }

  .btn-large {
    padding: var(--space-md) var(--space-xl);
    font-size: var(--text-base);
  }

  .btn-secondary {
    background: transparent;
    color: var(--color-text-muted);
    border: 1px solid var(--color-border);
  }

  .btn-secondary:hover {
    background: var(--color-bg-secondary);
    color: var(--color-text-secondary);
    border-color: var(--color-text-muted);
  }

  .btn:focus-visible {
    outline: 2px solid var(--color-gold);
    outline-offset: 2px;
  }

  /* Dashboard header with flourishes */
  .dashboard-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
    animation: fadeIn 0.5s ease-out;
  }

  .header-flourish {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
  }

  .header-flourish--bottom {
    margin-top: var(--space-sm);
    margin-bottom: 0;
  }

  .flourish-line {
    width: 40px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-gold));
  }

  .header-flourish--bottom .flourish-line {
    background: linear-gradient(90deg, var(--color-gold), transparent);
  }

  .flourish-line:last-child {
    background: linear-gradient(90deg, var(--color-gold), transparent);
  }

  .header-flourish--bottom .flourish-line:last-child {
    background: linear-gradient(90deg, transparent, var(--color-gold));
  }

  .flourish-diamond {
    width: 6px;
    height: 6px;
    background: var(--color-gold);
    transform: rotate(45deg);
    opacity: 0.7;
  }

  .welcome-label {
    font-family: var(--font-serif);
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin: 0;
  }

  .dashboard-title {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    color: var(--color-text);
    margin: var(--space-xs) 0;
    letter-spacing: 0.01em;
  }

  .dashboard-title span {
    color: var(--color-gold);
  }

  /* Mission teaser - proclamation style */
  .mission-teaser {
    position: relative;
    background: linear-gradient(
      135deg,
      var(--color-bg-secondary) 0%,
      var(--color-bg-tertiary) 100%
    );
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-lg) var(--space-xl);
    margin-bottom: var(--space-2xl);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    animation: fadeIn 0.6s ease-out 0.1s backwards;
  }

  .mission-teaser__seal {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 24px;
    height: 24px;
    background: var(--color-gold);
    border-radius: 50%;
    box-shadow:
      0 2px 8px rgba(var(--color-gold-rgb, 201, 162, 39), 0.4),
      inset 0 -2px 4px rgba(0, 0, 0, 0.2);
  }

  .mission-teaser__seal::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(45deg);
    width: 8px;
    height: 8px;
    border: 1px solid rgba(0, 0, 0, 0.2);
  }

  .mission-teaser__header {
    text-align: center;
    margin-bottom: var(--space-sm);
  }

  .mission-teaser__label {
    display: inline-block;
    font-size: var(--text-xs);
    color: var(--color-gold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 600;
    padding: var(--space-xs) var(--space-md);
    background: rgba(var(--color-gold-rgb, 201, 162, 39), 0.1);
    border-radius: var(--radius-sm);
  }

  .mission-teaser__title {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    color: var(--color-text);
    margin: var(--space-sm) 0;
    text-align: center;
    letter-spacing: 0.01em;
  }

  .mission-teaser__divider {
    width: 80px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-border), transparent);
    margin: var(--space-md) auto;
  }

  .mission-teaser__summary {
    font-family: var(--font-serif);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    margin: 0;
    line-height: 1.8;
    text-align: center;
    font-style: italic;
  }

  /* Dashboard grid */
  .dashboard-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
  }

  .dashboard-section {
    background: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    border: 1px solid var(--color-border);
    animation: fadeIn 0.5s ease-out 0.2s backwards;
  }

  .section-title {
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: var(--text-lg);
    color: var(--color-gold);
    margin: 0 0 var(--space-lg);
    position: relative;
  }

  .section-title__text {
    position: relative;
    padding: 0 var(--space-md);
    background: var(--color-bg-secondary);
    z-index: 1;
  }

  .section-title::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-border), transparent);
  }

  .section-title--dm .section-title__text {
    background: linear-gradient(135deg, var(--color-bg-secondary) 0%, rgba(var(--color-gold-rgb, 201, 162, 39), 0.05) 100%);
  }

  .dashboard-section--dm {
    border-color: rgba(var(--color-gold-rgb, 201, 162, 39), 0.3);
    background: linear-gradient(
      135deg,
      var(--color-bg-secondary) 0%,
      rgba(var(--color-gold-rgb, 201, 162, 39), 0.03) 100%
    );
    animation-delay: 0.3s;
  }

  /* Action cards */
  .action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--space-md);
  }

  .action-card {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--color-text);
    transition: all 0.2s ease;
    position: relative;
  }

  .action-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: var(--radius-md);
    background: linear-gradient(135deg, transparent 0%, rgba(var(--color-gold-rgb, 201, 162, 39), 0.05) 100%);
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .action-card:hover {
    border-color: var(--color-gold);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .action-card:hover::before {
    opacity: 1;
  }

  .action-card:focus-visible {
    outline: 2px solid var(--color-gold);
    outline-offset: 2px;
  }

  .action-card__icon {
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-tertiary);
    border-radius: var(--radius-sm);
    color: var(--color-text-muted);
    transition: all 0.2s ease;
  }

  .action-card:hover .action-card__icon {
    background: var(--color-gold);
    color: var(--color-bg);
  }

  .action-card__icon--dm {
    background: rgba(var(--color-gold-rgb, 201, 162, 39), 0.15);
    color: var(--color-gold);
  }

  .action-card--dm:hover .action-card__icon--dm {
    background: var(--color-gold);
    color: var(--color-bg);
  }

  .action-card--primary {
    border: 2px solid var(--color-gold);
    background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-secondary) 100%);
  }

  .action-card--primary:hover {
    box-shadow: 0 8px 32px rgba(var(--color-gold-rgb, 201, 162, 39), 0.2);
  }

  .action-card--dm {
    border-color: rgba(var(--color-gold-rgb, 201, 162, 39), 0.3);
  }

  .action-card--dm:hover {
    border-color: var(--color-gold);
    box-shadow: 0 8px 24px rgba(var(--color-gold-rgb, 201, 162, 39), 0.15);
  }

  .action-content {
    flex: 1;
    min-width: 0;
    position: relative;
    z-index: 1;
  }

  .action-title {
    font-family: var(--font-display);
    font-size: var(--text-base);
    margin: 0 0 var(--space-xs);
    color: var(--color-text);
    transition: color 0.2s ease;
  }

  .action-card:hover .action-title {
    color: var(--color-gold);
  }

  .action-description {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    margin: 0;
    line-height: 1.5;
  }

  .action-arrow {
    flex-shrink: 0;
    color: var(--color-text-muted);
    transition: all 0.2s ease;
    position: relative;
    z-index: 1;
  }

  .action-card:hover .action-arrow {
    color: var(--color-gold);
    transform: translateX(4px);
  }

  .character-badge {
    display: inline-block;
    margin-top: var(--space-xs);
    padding: 2px var(--space-sm);
    background: linear-gradient(135deg, var(--color-gold) 0%, var(--color-gold-light) 100%);
    color: var(--color-bg);
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
    letter-spacing: 0.02em;
  }

  .live-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-top: var(--space-xs);
    padding: 2px var(--space-sm);
    background: var(--color-success);
    color: white;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
    letter-spacing: 0.02em;
  }

  .live-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* Account section */
  .account-section {
    margin-top: var(--space-2xl);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-md);
    animation: fadeIn 0.5s ease-out 0.4s backwards;
  }

  .account-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    width: 100%;
    padding: 0 var(--space-xl);
  }

  .divider-line {
    flex: 1;
    max-width: 120px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-border));
  }

  .divider-line:last-child {
    background: linear-gradient(90deg, var(--color-border), transparent);
  }

  .divider-ornament {
    width: 8px;
    height: 8px;
    border: 1px solid var(--color-border);
    transform: rotate(45deg);
  }

  @media (max-width: 640px) {
    .dashboard {
      padding: var(--space-lg) var(--space-md);
    }

    .auth-prompt__frame {
      padding: var(--space-xl) var(--space-md);
    }

    .mission-teaser {
      padding: var(--space-md);
    }

    .action-grid {
      grid-template-columns: 1fr;
    }

    .action-card {
      padding: var(--space-sm) var(--space-md);
    }

    .action-card__icon {
      width: 36px;
      height: 36px;
    }

    .action-arrow {
      display: none;
    }

    .flourish-line {
      width: 24px;
    }
  }
</style>
